@page "/confirm"
@rendermode InteractiveServer

@inject NavigationManager Nav

<PageTitle>Confirm your login | DAIS</PageTitle>

@if (string.IsNullOrEmpty(returnUrl))
{
    <h2>Error: missing returnUrl</h2>
}
else
{
    <div>
        <h1>Confirm your login</h1>

        <p>You are currently signed in as @userName.</p>

        <p>
            Would you like to continue to the application using this account?
        </p>

        <div class="grid">
            <button @onclick="ConfirmLogin">Continue</button>
            <button class="outline second-button" @onclick="Logout">Switch account</button>
        </div>
    </div>
}

@code {

    [Parameter, SupplyParameterFromQuery]
    public string? returnUrl { get; set; }

    string userName = "";

    protected override void OnInitialized()
    {
        // read cookie-authenticated user
        var authUser = Nav.ToAbsoluteUri(Nav.Uri); // force load?
        // we can't read auth directly here, fetch from /userinfo?

        // simplest approach: require user to be already logged in
        // In the future: call /oauth/userinfo
        // For now: leave placeholder
        userName = "Authenticated user";
    }

    private void ConfirmLogin()
    {
        Nav.NavigateTo($"{returnUrl}&confirm=yes", forceLoad: true);
    }

    private void Logout()
    {
        Nav.NavigateTo("/logout", forceLoad: true);
    }
}